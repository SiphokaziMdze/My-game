<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Snake WebGL</title>
    <style>
        body {
            margin: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background-color: #222;
        }
        canvas {
            border: 2px solid #444;
        }
    </style>
</head>
<body>
    <canvas id="board"></canvas>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gl-matrix/2.8.1/gl-matrix-min.js"></script>
    <script>
        var gl;
        var shaderProgram;
        var snakeVertexBuffer;
        var foodVertexBuffer;
        var snakeColorBuffer;
        var foodColorBuffer;
        var board;
        var snakeBody = [];
        var snakeX = 5;
        var snakeY = 5;
        var velocityX = 0;
        var velocityY = 0;
        var foodX;
        var foodY;
        var rows = 20;
        var cols = 20;
        var blockSize = 25;
        var gameOver = false;

        window.onload = function() {
            board = document.getElementById(`board`);
            board.width = cols * blockSize;
            board.height = rows * blockSize;
            gl = board.getContext(`webgl`);

            if (!gl) {
                alert("WebGL is not available.");
                return;
            }

            initShaders();
            initBuffers();
            placeFood();
            document.addEventListener(`keydown`, changeDirection);
            setInterval(update, 100);
        }

        function initShaders() {
            var vsSource = `
                attribute vec2 a_position;
                attribute vec3 a_color;
                varying vec3 v_color;
                void main() {
                    gl_Position = vec4(a_position, 0.0, 1.0);
                    v_color = a_color;
                }
            `;

            var fsSource = `
                precision mediump float;
                varying vec3 v_color;
                void main() {
                    gl_FragColor = vec4(v_color, 1.0);
                }
            `;

            var vertexShader = gl.createShader(gl.VERTEX_SHADER);
            gl.shaderSource(vertexShader, vsSource);
            gl.compileShader(vertexShader);

            var fragmentShader = gl.createShader(gl.FRAGMENT_SHADER);
            gl.shaderSource(fragmentShader, fsSource);
            gl.compileShader(fragmentShader);

            shaderProgram = gl.createProgram();
            gl.attachShader(shaderProgram, vertexShader);
            gl.attachShader(shaderProgram, fragmentShader);
            gl.linkProgram(shaderProgram);
            gl.useProgram(shaderProgram);
        }

        function initBuffers() {
            snakeVertexBuffer = gl.createBuffer();
            gl.bindBuffer(gl.ARRAY_BUFFER, snakeVertexBuffer);
            gl.bufferData(gl.ARRAY_BUFFER, new Float32Array([
                snakeX, snakeY,
                snakeX + blockSize, snakeY,
                snakeX, snakeY + blockSize,
                snakeX + blockSize, snakeY + blockSize
            ]), gl.STATIC_DRAW);

            snakeColorBuffer = gl.createBuffer();
            gl.bindBuffer(gl.ARRAY_BUFFER, snakeColorBuffer);
            gl.bufferData(gl.ARRAY_BUFFER, new Float32Array([
                0.0, 0.3, 0.0,
                0.0, 0.3, 0.0,
                0.0, 0.3, 0.0,
                0.0, 0.3, 0.0
            ]), gl.STATIC_DRAW);

            foodVertexBuffer = gl.createBuffer();
            gl.bindBuffer(gl.ARRAY_BUFFER, foodVertexBuffer);
            gl.bufferData(gl.ARRAY_BUFFER, new Float32Array([
                foodX, foodY,
                foodX + blockSize, foodY,
                foodX, foodY + blockSize,
                foodX + blockSize, foodY + blockSize
            ]), gl.STATIC_DRAW);

            foodColorBuffer = gl.createBuffer();
            gl.bindBuffer(gl.ARRAY_BUFFER, foodColorBuffer);
            gl.bufferData(gl.ARRAY_BUFFER, new Float32Array([
                1.0, 0.0, 0.0,
                1.0, 0.0, 0.0,
                1.0, 0.0, 0.0,
                1.0, 0.0, 0.0
            ]), gl.STATIC_DRAW);
        }

        function update() {
            if (gameOver) {
                return;
            }

            gl.clearColor(0.0, 0.0, 0.0, 1.0);
            gl.clear(gl.COLOR_BUFFER_BIT);

            gl.bindBuffer(gl.ARRAY_BUFFER, snakeVertexBuffer);
            gl.vertexAttribPointer(0, 2, gl.FLOAT, false, 0, 0);
            gl.enableVertexAttribArray(0);

            gl.bindBuffer(gl.ARRAY_BUFFER, snakeColorBuffer);
            gl.vertexAttribPointer(1, 3, gl.FLOAT, false, 0, 0);
            gl.enableVertexAttribArray(1);

            gl.drawArrays(gl.TRIANGLE_STRIP, 0, 4);

            gl.bindBuffer(gl.ARRAY_BUFFER, foodVertexBuffer);
            gl.vertexAttribPointer(0, 2, gl.FLOAT, false, 0, 0);
            gl.enableVertexAttribArray(0);

            gl.bindBuffer(gl.ARRAY_BUFFER, foodColorBuffer);
            gl.vertexAttribPointer(1, 3, gl.FLOAT, false, 0, 0);
            gl.enableVertexAttribArray(1);

            gl.drawArrays(gl.TRIANGLE_STRIP, 0, 4);

            // Game logic here
        }

        function changeDirection(e) {
            if (e.code == "ArrowUp" && velocityY != 1) {
                velocityX = 0;
                velocityY = -1;
            }
            else if (e.code == "ArrowDown" && velocityY != -1) {
                velocityX = 0;
                velocityY = 1;
            }
            else if (e.code == "ArrowLeft" && velocityX != 1) {
                velocityX = -1;
                velocityY = 0;
            }
            else if (e.code == "ArrowRight" && velocityX != -1) {
                velocityX = 1;
                velocityY = 0;
            }
        }

        function placeFood() {
            foodX = Math.floor(Math.random() * cols) * blockSize;
            foodY = Math.floor(Math.random() * rows) * blockSize;
        }
    </script>
</body>
</html>
